# Azure Resource Automation

Azure Automation implemenation for bringing up and shutting down Azure resources on a schedule.  This work was implemented in order to provide a flexible way to stop and start costly resources based on a regular schedule.

## Getting Started

These instructions provide steps to create automation infrastructure as well as the runbooks to start/stop resources at a specified time of the day.

The automation currently supports:

- AKS Cluster and Application Gateways set up as pairs in NGSA-ASB repository

### Prerequisites

Requirements for using:

- Azure subscription
- Account to execute bicep deployments on that subscription (account should have at least contributor role to subscription)

### Resources that are generated by running the bicep deployment

- Resource Group
- User Assigned Managed Identity
  - Role Assignment
- Automation Account
  - Schedules
  - Runbooks
  - Job Schedules
  - Diagnostic Settings

### Running the bicep deployment

1. Log into Azure Subscription with Account that has Contributor role
2. Set up the bicep parameters to match your environment
3. Run the following command

   ``` shell
      az deployment sub create --debug --location <location> --template-file /workspaces/ngsa-asb/scripts/ResourceAutomation/automation.bicep
   ```
